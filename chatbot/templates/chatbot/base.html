<!DOCTYPE html>
<html lang="en">

<head>
  {% load static %}
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,600,700" rel="stylesheet" />
  <link rel="shortcut icon" href="static/images/robo.jpg" type="image/x-icon" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/a11y-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <link rel="stylesheet" href="{% static "css/style.css" %}" />

  <title>Chat Bot</title>
</head>

<body>
  <div class="container">
    <header class="header">
      <h1 class="logo" >ðŸ¤– Chat-Bot</h1>

      <div class="user">
        <div class="user-image">
            <img src="{% static 'images/user.png' %}" alt="user-image" />
          </div>
          <p class="username">{% if user.is_authenticated %}{{request.user | title}} {% else %} User{% endif %}</p>
      </div>
      
     


    </header>

    <div class="sidebar">
      <nav class='nav'>
        <h2>Health-Care </h2>
        <ul>
          <li>chat-Bot</li>
          <li>image-Ai</li>
        </ul>
      </nav>
      


      <div class="side-bottom">
        {% if user.is_authenticated %}
        <a href="/user/logout/" class="login">Logout</a>

        {% else %}
        <a href="/user/login/" class="login">Login</a>
        {% endif %}
      <p class="copyright">&copy; Aditya Dhamanekar</p>
      </div>

    </div>

    <div class="chat-container">

      

      {% comment %} messages {% endcomment %}

      <div class="messages"  id="message-container">

        {% if user.is_authenticated %}
         {% for message in all_messages %}
        <div class="message {% if message.user == request.user %}sent{% else %}received{% endif %}">
          <div class="message-image">
            <img src="{% static 'images/user.png' %}" alt="user-image" />
          </div>
          <div class="message-text">
            {% if message.user == request.user %}
            <strong>You :</strong>
            {% else %}
            <strong>{{ message.user.username }}:</strong>
            {% endif %}
            {{ message.user_message }}
          </div>
        </div>
        <div class="message">
          <div class="message-image">
            <img src="{% static 'images/robo.jpg' %}" alt="bot-image" />
          </div>
          <div class="message-text">
            <strong>Gemini :</strong>
            <pre><code>{{ message.gemini_response }}</code></pre>
          </div>
        </div>
        {% endfor %}
    
{% else %}
        {% if user_message %}
        <div class="message ">
          <div class="message-image">
            <img src="{% static 'images/favicon.png' %}" alt="user-image" />
          </div>
          <div class="message-text">
            
            <strong>You : </strong>
            
            {{ user_message }}
          </div>
        </div>

        <div class="message">
          <div class="message-image">
            <img src="{% static 'images/gemini-Ai.webp' %}" alt="bot-image" />
          </div>
          <div class="message-text">
            <strong>Gemini : </strong>
            <pre><code>{{ gemini_response }}</code></pre>
          </div>
        </div>
        
        {% endif %}
   
{% endif %}

       

      </div>



      {% comment %} chat_box {% endcomment %}
      <form class="chat-box" method="post"  >
        {% csrf_token %}
        <input type="text" placeholder="Enter your message" class="chat-input" name="user_message" />
        <button class="chat-send" type="submit">Send</button>
      </form>
    </div>


    <script>
  function scrollToBottom() {
    var container = document.getElementById("message-container");
    container.scrollTop = container.scrollHeight;
  }

  // Call scrollToBottom() after the page is loaded and after submitting a new message
  document.addEventListener("DOMContentLoaded", function() {
    scrollToBottom();
  });

  document.querySelector('.chat-box').addEventListener('submit', function() {
    scrollToBottom();
  });
</script>

    

    
</body>

</html>